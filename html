<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOP-50 | Единый реестр программ переподготовки</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.263.0/dist/umd/lucide.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        rgsu: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                            950: '#0a0e17'
                        },
                        accent: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e'
                        }
                    },
                    fontFamily: {
                        body: ['Inter', 'sans-serif'],
                        heading: ['Manrope', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Manrope:wght@600;700;800&display=swap');
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .gradient-border { background: linear-gradient(45deg, #0ea5e9, #3b82f6, #8b5cf6, #ec4899); padding: 2px; border-radius: 1.5rem; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen text-slate-100 font-body">
    <!-- Header -->
    <header class="container mx-auto px-4 py-8">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-2xl bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center">
                    <span class="text-white font-bold text-xl">TOP</span>
                </div>
                <div>
                    <h1 class="text-2xl font-bold font-heading bg-clip-text text-transparent bg-gradient-to-r from-white to-blue-300">
                        Реестр программ для участников СВО
                    </h1>
                    <p class="text-slate-400 text-sm">Бюджетные места, специальные квоты и приоритетное зачисление</p>
                </div>
            </div>
            <div class="flex flex-wrap gap-2 justify-end" id="dataSourceInfo">
                <span class="text-xs bg-rgsu-900/50 text-rgsu-200 px-3 py-1 rounded-full">
                    Источник данных: Единая база TOP-50
                </span>
            </div>
        </div>
    </header>

    <!-- Hero and Search -->
    <section class="container mx-auto px-4 mb-12">
        <div class="text-center max-w-3xl mx-auto mb-10">
            <h2 class="text-4xl md:text-5xl font-bold font-heading mb-6">
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-white to-blue-200">Вашего будущего</span>
            </h2>
            <p class="text-slate-300 mb-10 max-w-2xl mx-auto text-lg font-body leading-relaxed">
                Единый реестр государственных программ переподготовки и высшего образования.
                <span class="text-white font-medium">Бюджетные места</span>, специальные квоты и приоритетное зачисление для участников СВО.
            </p>
            
            <!-- Search Box -->
            <div class="relative max-w-2xl mx-auto transform transition-transform duration-300 z-20">
                <div class="absolute inset-0 bg-accent/20 blur-xl rounded-full"></div>
                <div class="relative flex flex-col sm:flex-row bg-white rounded-2xl shadow-2xl overflow-hidden p-1.5 gap-2">
                    <div class="relative flex-grow flex items-center">
                        <i data-lucide="search" class="w-5 h-5 text-slate-400 absolute left-4"></i>
                        <input type="text" id="searchInput" placeholder="Найти профессию, вуз или код (09.03.01)..." 
                               class="w-full pl-12 pr-4 py-3 text-base text-slate-900 placeholder-slate-400 focus:outline-none h-full bg-transparent">
                    </div>
                    <button class="bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 text-white font-medium px-6 py-3 rounded-xl flex items-center justify-center gap-2 transition-all duration-300 shadow-lg hover:shadow-xl">
                        <i data-lucide="search" class="w-5 h-5"></i>
                        <span>Найти</span>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Filters -->
    <section class="container mx-auto px-4 mb-8">
        <div class="max-w-6xl mx-auto bg-rgsu-900/40 backdrop-blur-sm rounded-2xl p-4 border border-rgsu-800/50">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                <!-- Level Filter -->
                <div class="relative">
                    <label class="block text-xs font-medium text-slate-400 mb-1 ml-1">Уровень образования</label>
                    <select id="levelFilter" class="w-full bg-rgsu-800/50 border border-rgsu-700 text-white rounded-xl px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="all">Все уровни</option>
                        <option value="VO">ВУЗ (Высшее образование)</option>
                        <option value="SPO">Колледж (Среднее проф. образование)</option>
                    </select>
                </div>
                
                <!-- Region Filter -->
                <div class="relative">
                    <label class="block text-xs font-medium text-slate-400 mb-1 ml-1">Регион обучения</label>
                    <select id="regionFilter" class="w-full bg-rgsu-800/50 border border-rgsu-700 text-white rounded-xl px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="all">Все регионы</option>
                        <optgroup label="Центральный ФО">
                            <option value="Москва">Москва</option>
                            <option value="Санкт-Петербург">Санкт-Петербург</option>
                        </optgroup>
                        <optgroup label="Приволжский ФО">
                            <option value="Казань">Казань</option>
                            <option value="Челябинск">Челябинск</option>
                            <option value="Ростов-на-Дону">Ростов-на-Дону</option>
                        </optgroup>
                        <optgroup label="Сибирский ФО">
                            <option value="Красноярск">Красноярск</option>
                            <option value="Ярославль">Ярославль</option>
                        </optgroup>
                    </select>
                </div>
                
                <!-- Category Filter -->
                <div class="relative">
                    <label class="block text-xs font-medium text-slate-400 mb-1 ml-1">Категория</label>
                    <select id="categoryFilter" class="w-full bg-rgsu-800/50 border border-rgsu-700 text-white rounded-xl px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="all">Все категории</option>
                        <option value="IT и цифровые технологии">IT и цифровые технологии</option>
                        <option value="Энергетика и электросети">Энергетика и электросети</option>
                        <option value="Строительство и архитектура">Строительство и архитектура</option>
                        <option value="Машиностроение">Машиностроение</option>
                        <option value="Транспорт и БПЛА">Транспорт и БПЛА</option>
                        <option value="Нефтегазовая промышленность">Нефтегазовая промышленность</option>
                        <option value="Здравоохранение">Здравоохранение</option>
                        <option value="Агро и пищевые технологии">Агро и пищевые технологии</option>
                        <option value="Образование и гуманитарные">Образование и гуманитарные</option>
                        <option value="Право и управление">Право и управление</option>
                    </select>
                </div>
                
                <!-- Budget Filter -->
                <div class="flex items-end">
                    <label class="flex items-center gap-2 cursor-pointer group">
                        <div class="relative">
                            <input type="checkbox" id="budgetToggle" checked class="peer sr-only">
                            <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                        </div>
                        <span class="text-sm font-medium text-slate-300 group-hover:text-white transition-colors">Только бюджет</span>
                    </label>
                </div>
                
                <!-- Reset Filters -->
                <div class="flex items-end justify-end">
                    <button id="resetFilters" class="px-4 py-2 text-sm font-medium text-slate-300 hover:text-white hover:bg-rgsu-800 rounded-xl transition-colors flex items-center gap-2">
                        <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                        Сбросить фильтры
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Results Count & Sort -->
    <section class="container mx-auto px-4 mb-6">
        <div class="max-w-6xl mx-auto flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <div>
                <h3 class="text-sm font-semibold text-slate-400" id="resultsCount">Найдено: <span class="text-rgsu-300 font-bold">0</span> программ</h3>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-xs font-medium text-slate-400">Сортировать:</span>
                <select id="sortSelect" class="bg-rgsu-800/50 border border-rgsu-700 text-white rounded-lg px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="relevance">По релевантности</option>
                    <option value="budget">Сначала бюджетные</option>
                    <option value="region">По регионам</option>
                </select>
            </div>
        </div>
    </section>

    <!-- Programs Grid -->
    <section class="container mx-auto px-4 pb-16">
        <div class="max-w-6xl mx-auto">
            <div id="programsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Карточки программ будут отображаться здесь -->
            </div>
            
            <!-- Pagination -->
            <div id="pagination" class="mt-10 flex justify-center items-center gap-2">
                <button id="prevPage" class="px-4 py-2 bg-rgsu-800 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
                    <i data-lucide="chevron-left" class="w-4 h-4 inline-block mr-1"></i> Назад
                </button>
                <div id="pageNumbers" class="flex gap-1"></div>
                <button id="nextPage" class="px-4 py-2 bg-rgsu-800 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
                    Вперед <i data-lucide="chevron-right" class="w-4 h-4 inline-block ml-1"></i>
                </button>
            </div>
            
            <!-- Load More Button for mobile -->
            <div id="loadMoreContainer" class="mt-8 text-center block lg:hidden">
                <button id="loadMoreBtn" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 text-white font-medium rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl">
                    Загрузить еще
                </button>
            </div>
        </div>
    </section>

    <!-- Modal for detailed view -->
    <div id="detailModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="bg-slate-900 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto relative">
            <button id="closeModal" class="absolute top-4 right-4 text-slate-400 hover:text-white p-2">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <div id="modalContent" class="p-6">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Функция преобразования данных из Excel в формат для интерфейса
        function transformExcelData(excelData) {
            return excelData.map(item => {
                // Определение уровня образования
                const isVO = item.education_level === 'ВО';
                const levelType = isVO ? 'БАКАЛАВРИАТ' : 'СПО';
                
                // Определение типа заведения
                const institutionType = isVO ? 'ВУЗ' : 'ССУЗ';
                
                // Определение срока обучения
                const duration = isVO ? '4 года' : '2-3 года';
                
                // Проверка бюджетных мест
                const hasBudget = item.budget_seats && (
                    item.budget_seats.includes('Есть бюджетные места') || 
                    item.budget_seats.includes('мест') ||
                    !item.budget_seats.includes('Нет бюджетных мест')
                );
                
                // Очистка названия программы
                let programName = item.program_name || 'Без названия';
                if (programName.includes('Не указано') || programName === 'Не указано') {
                    programName = `Программа по направлению ${item.fgos_code}`;
                }
                
                // Очистка названия учреждения
                let institutionName = item.institution_name || 'Учебное заведение не указано';
                if (institutionName.includes('Учебное заведение не указано') || institutionName.includes('Настроить по ссузу')) {
                    institutionName = 'Ведущие учебные заведения региона';
                }
                if (institutionName.startsWith('2 профиля обучения') || institutionName.startsWith('3 профиля обучения')) {
                    institutionName = institutionName.replace(/^(2|3) профиля обучения/, '').trim();
                }
                if (institutionName.includes('Рекомендованные:')) {
                    institutionName = institutionName.split('Рекомендованные:')[0].trim();
                }
                
                // Определение федерального округа по региону
                let federalDistrict = 'Прочие регионы';
                if (['Москва', 'Санкт-Петербург'].includes(item.region)) {
                    federalDistrict = 'ЦФО';
                } else if (['Казань', 'Челябинск', 'Ростов-на-Дону'].includes(item.region)) {
                    federalDistrict = 'ПФО/ЮФО';
                } else if (['Красноярск', 'Ярославль'].includes(item.region)) {
                    federalDistrict = 'СФО';
                }
                
                return {
                    id: item.id,
                    title: programName,
                    fgos_code: item.fgos_code,
                    institution: institutionName,
                    region: item.region,
                    federal_district: federalDistrict,
                    level: isVO ? 'VO' : 'SPO',
                    level_readable: isVO ? 'ВУЗ' : 'Колледж',
                    level_type: levelType,
                    duration: duration,
                    category: item.macrogroup_name,
                    has_budget: hasBudget,
                    budget_info: item.budget_seats,
                    url: item.url,
                    institution_type: institutionType
                };
            });
        }

        // Статические данные из Excel (первые несколько записей для демонстрации)
        const excelData = [
            { id: 1, macrogroup_id: 1, macrogroup_name: "IT и цифровые технологии", education_level: "ВО", fgos_code: "09.03.01", program_name: "Не указано", institution_name: "Учебное заведение не указано", region: "Казань", budget_seats: "15 мест (2025)", url: "https://postupi.online/postupika/" },
            { id: 2, macrogroup_id: 1, macrogroup_name: "IT и цифровые технологии", education_level: "ВО", fgos_code: "09.03.01", program_name: "Экономика и управление (бакалавриат)", institution_name: "РАНХиГСв Финансовом университетеВсе профили", region: "Москва", budget_seats: "Есть бюджетные места (2025)", url: "https://postupi.online/specialnost/38.03.06/" },
            { id: 3, macrogroup_id: 1, macrogroup_name: "IT и цифровые технологии", education_level: "ВО", fgos_code: "09.03.01", program_name: "Образование и педагогические науки (бакалавриат)", institution_name: "Университете Синергияв СФУВсе профили", region: "Красноярск", budget_seats: "Есть бюджетные места (2025)", url: "https://postupi.online/specialnost/44.03.05/" },
            { id: 4, macrogroup_id: 1, macrogroup_name: "IT и цифровые технологии", education_level: "ВО", fgos_code: "09.03.02", program_name: "Не указано", institution_name: "Учебное заведение не указано", region: "Казань", budget_seats: "25 мест (2025)", url: "https://postupi.online/postupika/" },
            { id: 5, macrogroup_id: 1, macrogroup_name: "IT и цифровые технологии", education_level: "ВО", fgos_code: "09.03.02", program_name: "Мехатроника и робототехника", institution_name: "Университете Синергияв РГУ им", region: "Ростов-на-Дону", budget_seats: "Есть бюджетные места (2025)", url: "https://postupi.online/specialnost/15.03.06/" },
            { id: 6, macrogroup_id: 1, macrogroup_name: "IT и цифровые технологии", education_level: "ВО", fgos_code: "09.03.02", program_name: "Реклама и связи с общественностью", institution_name: "Университете Синергияв МГПУВсе профили", region: "Челябинск", budget_seats: "Есть бюджетные места (2025)", url: "https://postupi.online/specialnost/42.03.01/" },
            { id: 10, macrogroup_id: 1, macrogroup_name: "IT и цифровые технологии", education_level: "ВО", fgos_code: "01.03.02", program_name: "Не указано", institution_name: "Учебное заведение не указано", region: "Казань", budget_seats: "Нет бюджетных мест (2025)", url: "https://postupi.online/postupika/" },
            { id: 11, macrogroup_id: 1, macrogroup_name: "IT и цифровые технологии", education_level: "ВО", fgos_code: "01.03.02", program_name: "Экономика и управление (бакалавриат)", institution_name: "РАНХиГСв Финансовом университетеВсе профили", region: "Москва", budget_seats: "Есть бюджетные места (2025)", url: "https://postupi.online/specialnost/38.03.06/" },
            { id: 12, macrogroup_id: 1, macrogroup_name: "IT и цифровые технологии", education_level: "ВО", fgos_code: "01.03.02", program_name: "Образование и педагогические науки (бакалавриат)", institution_name: "Университете Синергияв СФУВсе профили", region: "Красноярск", budget_seats: "Есть бюджетные места (2025)", url: "https://postupi.online/specialnost/44.03.05/" },
            { id: 23, macrogroup_id: 1, macrogroup_name: "IT и цифровые технологии", education_level: "СПО", fgos_code: "09.02.06", program_name: "Образование и педагогические науки (СПО)", institution_name: "2 профиля обученияРекомендованные:в Открытый колледжв Колледж РосНОУВсе профили", region: "Санкт-Петербург", budget_seats: "Есть бюджетные места (2025)", url: "https://postupi.online/specialnost-spo/44.02.05/" },
            { id: 24, macrogroup_id: 1, macrogroup_name: "IT и цифровые технологии", education_level: "СПО", fgos_code: "09.02.06", program_name: "Техника и технологии строительства (СПО)", institution_name: "1 профиль обученияРекомендованные:в 26 кадр колледжВсе профили", region: "Москва", budget_seats: "Есть бюджетные места (2025)", url: "https://postupi.online/specialnost-spo/08.02.04/" },
            { id: 34, macrogroup_id: 1, macrogroup_name: "IT и цифровые технологии", education_level: "СПО", fgos_code: "09.02.07", program_name: "Химические технологии (СПО)", institution_name: "1 профиль обученияРекомендованные:в 26 кадр колледжВсе профили", region: "Москва", budget_seats: "Есть бюджетные места (2025)", url: "https://postupi.online/specialnost-spo/18.02.13/" },
            { id: 125, macrogroup_id: 3, macrogroup_name: "Строительство и архитектура", education_level: "ВО", fgos_code: "08.03.01", program_name: "Не указано", institution_name: "Учебное заведение не указано", region: "Казань", budget_seats: "Нет бюджетных мест (2025)", url: "https://postupi.online/postupika/" },
            { id: 126, macrogroup_id: 3, macrogroup_name: "Строительство и архитектура", education_level: "ВО", fgos_code: "08.03.01", program_name: "Экономика и управление (бакалавриат)", institution_name: "РАНХиГСв Финансовом университетеВсе профили", region: "Москва", budget_seats: "Есть бюджетные места (2025)", url: "https://postupi.online/specialnost/38.03.06/" },
            { id: 127, macrogroup_id: 3, macrogroup_name: "Строительство и архитектура", education_level: "ВО", fgos_code: "08.03.01", program_name: "Образование и педагогические науки (бакалавриат)", institution_name: "Университете Синергияв СФУВсе профили", region: "Красноярск", budget_seats: "Есть бюджетные места (2025)", url: "https://postupi.online/specialnost/44.03.05/" }
        ];

        // Преобразование данных
        let allPrograms = transformExcelData(excelData);
        let filteredPrograms = [...allPrograms];
        let currentPage = 1;
        const programsPerPage = 12;
        let totalPages = Math.ceil(filteredPrograms.length / programsPerPage);

        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const budgetToggle = document.getElementById('budgetToggle');
        const levelFilter = document.getElementById('levelFilter');
        const regionFilter = document.getElementById('regionFilter');
        const categoryFilter = document.getElementById('categoryFilter');
        const sortSelect = document.getElementById('sortSelect');
        const resetFiltersBtn = document.getElementById('resetFilters');
        const programsGrid = document.getElementById('programsGrid');
        const resultsCount = document.getElementById('resultsCount');
        const prevPageBtn = document.getElementById('prevPage');
        const nextPageBtn = document.getElementById('nextPage');
        const pageNumbersContainer = document.getElementById('pageNumbers');
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        const detailModal = document.getElementById('detailModal');
        const closeModalBtn = document.getElementById('closeModal');
        const modalContent = document.getElementById('modalContent');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Set up event listeners
            searchInput.addEventListener('input', debounce(filterAndRender, 300));
            budgetToggle.addEventListener('change', filterAndRender);
            levelFilter.addEventListener('change', filterAndRender);
            regionFilter.addEventListener('change', filterAndRender);
            categoryFilter.addEventListener('change', filterAndRender);
            sortSelect.addEventListener('change', filterAndRender);
            resetFiltersBtn.addEventListener('click', resetFilters);
            prevPageBtn.addEventListener('click', () => changePage(currentPage - 1));
            nextPageBtn.addEventListener('click', () => changePage(currentPage + 1));
            loadMoreBtn.addEventListener('click', loadMorePrograms);
            closeModalBtn.addEventListener('click', closeDetailModal);
            
            // Initial render
            filterAndRender();
            
            // Setup icons
            lucide.createIcons();
        });

        // Debounce function for search
        function debounce(func, delay) {
            let timeoutId;
            return (...args) => {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => func.apply(this, args), delay);
            };
        }

        // Reset all filters
        function resetFilters() {
            searchInput.value = '';
            budgetToggle.checked = true;
            levelFilter.value = 'all';
            regionFilter.value = 'all';
            categoryFilter.value = 'all';
            sortSelect.value = 'relevance';
            currentPage = 1;
            filterAndRender();
        }

        // Filter programs based on current filters
        function filterPrograms() {
            const query = searchInput.value.toLowerCase().trim();
            const onlyBudget = budgetToggle.checked;
            const selectedLevel = levelFilter.value;
            const selectedRegion = regionFilter.value;
            const selectedCategory = categoryFilter.value;
            const sortOption = sortSelect.value;
            
            filteredPrograms = allPrograms.filter(program => {
                // Search filter
                const matchesSearch = 
                    program.title.toLowerCase().includes(query) ||
                    program.fgos_code.toLowerCase().includes(query) ||
                    program.institution.toLowerCase().includes(query) ||
                    program.region.toLowerCase().includes(query);
                
                // Budget filter
                const matchesBudget = onlyBudget ? program.has_budget : true;
                
                // Level filter
                const matchesLevel = selectedLevel === 'all' || 
                    (selectedLevel === 'VO' && program.level === 'VO') || 
                    (selectedLevel === 'SPO' && program.level === 'SPO');
                
                // Region filter
                const matchesRegion = selectedRegion === 'all' || program.region === selectedRegion;
                
                // Category filter
                const matchesCategory = selectedCategory === 'all' || program.category === selectedCategory;
                
                return matchesSearch && matchesBudget && matchesLevel && matchesRegion && matchesCategory;
            });
            
            // Sorting
            if (sortOption === 'budget') {
                filteredPrograms.sort((a, b) => b.has_budget - a.has_budget);
            } else if (sortOption === 'region') {
                filteredPrograms.sort((a, b) => a.region.localeCompare(b.region));
            }
            
            totalPages = Math.ceil(filteredPrograms.length / programsPerPage);
            currentPage = Math.min(currentPage, totalPages || 1);
            
            // Update results count
            resultsCount.innerHTML = `Найдено: <span class="text-rgsu-300 font-bold">${filteredPrograms.length}</span> программ`;
        }

        // Get programs for current page
        function getCurrentPagePrograms() {
            const startIndex = (currentPage - 1) * programsPerPage;
            const endIndex = startIndex + programsPerPage;
            return filteredPrograms.slice(startIndex, endIndex);
        }

        // Render programs grid
        function renderPrograms() {
            const currentPrograms = getCurrentPagePrograms();
            programsGrid.innerHTML = '';
            
            if (currentPrograms.length === 0) {
                programsGrid.innerHTML = `
                    <div class="col-span-1 md:col-span-2 lg:col-span-3 xl:col-span-4 text-center py-16 bg-rgsu-900/30 rounded-2xl border border-dashed border-rgsu-700">
                        <div class="bg-slate-800 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="search-x" class="w-10 h-10 text-slate-500"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-200 mb-2">Ничего не найдено</h3>
                        <p class="text-slate-400 max-w-md mx-auto mb-4">Попробуйте изменить параметры поиска или отключить фильтр "Только бюджет"</p>
                        <button onclick="resetFilters()" class="mt-4 px-6 py-2 bg-gradient-to-r from-blue-600 to-cyan-500 text-white font-medium rounded-xl hover:opacity-90 transition-opacity">
                            Сбросить фильтры
                        </button>
                    </div>
                `;
                lucide.createIcons();
                return;
            }
            
            currentPrograms.forEach(program => {
                const budgetBadge = program.has_budget ? 
                    `<span class="absolute top-3 right-3 bg-green-600 text-white text-xs font-bold px-2 py-1 rounded-full">Бюджет</span>` : 
                    '';
                
                const card = document.createElement('div');
                card.className = 'bg-rgsu-900/30 backdrop-blur-sm rounded-2xl p-5 border border-rgsu-800/50 card-hover cursor-pointer transition-all';
                card.innerHTML = `
                    <div class="relative mb-4">
                        ${budgetBadge}
                        <span class="inline-block bg-rgsu-800/70 text-blue-300 text-xs font-medium px-2.5 py-1 rounded-lg">${program.level_type}</span>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-1 line-clamp-1">${program.title}</h3>
                    <p class="text-slate-300 text-sm mb-3 line-clamp-1">${program.institution}</p>
                    
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-2">
                            <i data-lucide="map-pin" class="w-4 h-4 text-slate-400"></i>
                            <span class="text-xs text-slate-300">${program.region}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i data-lucide="book-open" class="w-4 h-4 text-slate-400"></i>
                            <span class="text-xs font-medium text-slate-300">${program.institution_type}</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between mb-4 pt-2 border-t border-rgsu-800/50">
                        <span class="text-xs font-medium text-slate-400 bg-rgsu-800/50 px-2 py-1 rounded">${program.fgos_code}</span>
                        <span class="text-xs font-medium text-slate-400">
                            <i data-lucide="clock" class="w-3 h-3 inline-block mr-1"></i>
                            ${program.duration}
                        </span>
                    </div>
                    
                    <button class="w-full mt-2 py-2 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-medium text-sm rounded-lg transition-all flex items-center justify-center gap-2">
                        <span>Подробнее о программе</span>
                        <i data-lucide="arrow-right" class="w-4 h-4"></i>
                    </button>
                `;
                card.addEventListener('click', () => showProgramDetail(program));
                programsGrid.appendChild(card);
            });
            
            // Update pagination
            updatePagination();
            
            // Initialize icons
            lucide.createIcons();
        }

        // Update pagination controls
        function updatePagination() {
            // Desktop pagination
            pageNumbersContainer.innerHTML = '';
            
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `w-8 h-8 rounded-lg flex items-center justify-center font-medium transition-all ${currentPage === i ? 'bg-blue-600 text-white' : 'bg-rgsu-800 text-slate-300 hover:bg-rgsu-700'}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => changePage(i));
                pageNumbersContainer.appendChild(pageBtn);
            }
            
            // Disable prev/next buttons if needed
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
            
            // Show/hide pagination based on total pages
            document.getElementById('pagination').style.display = totalPages > 1 ? 'flex' : 'none';
        }

        // Change page
        function changePage(page) {
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderPrograms();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Load more programs for mobile view
        function loadMorePrograms() {
            currentPage++;
            renderPrograms();
        }

        // Show program details in modal
        function showProgramDetail(program) {
            modalContent.innerHTML = `
                <div class="space-y-6">
                    <div class="space-y-2">
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="inline-block bg-rgsu-800 text-blue-400 px-2.5 py-1 rounded-lg text-sm font-medium">${program.level_type}</span>
                                <span class="inline-flex items-center rounded-md bg-green-500/20 px-2 py-1 text-xs font-medium text-green-300 ring-1 ring-inset ring-green-500/30 ml-2">
                                    ${program.federal_district}
                                </span>
                            </div>
                            ${program.has_budget ? `<span class="inline-flex items-center px-3 py-1 rounded-full bg-green-600/20 text-green-300 font-medium text-sm">
                                <i data-lucide="wallet" class="w-4 h-4 mr-1"></i>
                                ${program.budget_info}
                            </span>` : ''}
                        </div>
                        <h2 class="text-2xl font-bold text-white">${program.title}</h2>
                        <p class="text-slate-400 text-base">${program.fgos_code}</p>
                        <p class="text-blue-400 font-medium text-lg">${program.institution}</p>
                    </div>
                    
                    <!-- Информационные карточки -->
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-6">
                        <div class="bg-rgsu-800/50 p-3 rounded-xl border border-rgsu-700">
                            <p class="text-xs text-slate-400 mb-1">Уровень образования</p>
                            <p class="text-lg font-bold text-white">${program.level_readable}</p>
                        </div>
                        <div class="bg-rgsu-800/50 p-3 rounded-xl border border-rgsu-700">
                            <p class="text-xs text-slate-400 mb-1">Срок обучения</p>
                            <p class="text-lg font-bold text-white">${program.duration}</p>
                        </div>
                        <div class="bg-rgsu-800/50 p-3 rounded-xl border border-rgsu-700">
                            <p class="text-xs text-slate-400 mb-1">Категория</p>
                            <p class="text-lg font-bold text-white">${program.category}</p>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2">
                                <i data-lucide="info" class="w-5 h-5 text-blue-400"></i>
                                О программе
                            </h3>
                            <p class="text-slate-300 leading-relaxed">
                                Программа ${program.level_type.toLowerCase()} по специальности "${program.title}" предоставляет возможность получения качественного образования в сфере "${program.category}". Для получения более подробной информации о программе, условиях поступления и особенностях обучения перейдите по ссылке ниже.
                            </p>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2">
                                <i data-lucide="map-pin" class="w-5 h-5 text-blue-400"></i>
                                Регион обучения
                            </h3>
                            <p class="text-slate-300">${program.region}</p>
                        </div>
                        
                        <a href="${program.url}" target="_blank" class="block w-full bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 text-white font-bold py-3 px-6 rounded-xl text-center transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                            Перейти на страницу программы
                        </a>
                    </div>
                </div>
            `;
            
            detailModal.classList.remove('hidden');
            lucide.createIcons();
        }

        // Close detail modal
        function closeDetailModal() {
            detailModal.classList.add('hidden');
        }

        // Close modal when clicking outside
        detailModal.addEventListener('click', (e) => {
            if (e.target === detailModal) {
                closeDetailModal();
            }
        });

        // Main filter and render function
        function filterAndRender() {
            filterPrograms();
            renderPrograms();
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !detailModal.classList.contains('hidden')) {
                closeDetailModal();
            }
        });
    </script>
</body>
</html>
